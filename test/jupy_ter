import cv2, numpy as np
from IPython.display import display, clear_output
from PIL import Image
import time

# Pipeline GStreamer para Jetson Nano + CSI (IMX219 tÃ­pico)
gst = (
    "nvarguscamerasrc ! "
    "video/x-raw(memory:NVMM), width=1280, height=720, framerate=30/1 ! "
    "nvvidconv flip-method=0 ! "
    "video/x-raw, format=BGR ! "
    "appsink drop=true max-buffers=1 sync=false"
)

cap = cv2.VideoCapture(gst, cv2.CAP_GSTREAMER)
assert cap.isOpened(), "No pude abrir la CSI con GStreamer desde OpenCV (revisa kernel y GStreamer)."

for i in range(60):  # ~2 segundos a 30 fps
    ok, frame = cap.read()
    if not ok:
        print("Frame perdido"); break
    # BGR -> RGB para mostrar
    rgb = cv2.cvtColor(frame, cv2.COLOR_BGR2RGB)
    clear_output(wait=True)
    display(Image.fromarray(rgb))
    time.sleep(0.03)  # ~30 fps

cap.release()
